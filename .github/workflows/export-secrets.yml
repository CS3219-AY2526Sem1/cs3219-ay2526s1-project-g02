name: Export Secrets (TEMPORARY - DELETE AFTER USE)

# SECURITY WARNING: This workflow exports secrets to an artifact
# Only run this when you need to backup secrets for migration
# DELETE THIS FILE after you've downloaded the secrets!

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:  # Can also run manually

jobs:
  export-secrets:
    name: Export Secrets to Artifact
    runs-on: ubuntu-latest
    
    steps:
    - name: Create secrets backup file
      run: |
        echo "# NoClue GitHub Secrets Backup" > secrets-backup.txt
        echo "# Generated: $(date)" >> secrets-backup.txt
        echo "# KEEP THIS FILE SECURE - DELETE AFTER USE" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        echo "================================================" >> secrets-backup.txt
        echo "GITHUB SECRETS FOR REPOSITORY MIGRATION" >> secrets-backup.txt
        echo "================================================" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "GCP_PROJECT_ID=${{ secrets.GCP_PROJECT_ID }}" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# SUPABASE_URL (first 50 chars shown for verification):" >> secrets-backup.txt
        echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# SUPABASE_SECRET_KEY (first 20 chars shown for verification):" >> secrets-backup.txt
        echo "SUPABASE_SECRET_KEY=${{ secrets.SUPABASE_SECRET_KEY }}" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# SUPABASE_PUBLISHABLE_KEY (first 20 chars shown for verification):" >> secrets-backup.txt
        echo "SUPABASE_PUBLISHABLE_KEY=${{ secrets.SUPABASE_PUBLISHABLE_KEY }}" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# OPENAI_API_KEY (first 10 chars shown for verification):" >> secrets-backup.txt
        echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "================================================" >> secrets-backup.txt
        echo "GCP SERVICE ACCOUNT KEYS (JSON)" >> secrets-backup.txt
        echo "================================================" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# GCP_SA_KEY:" >> secrets-backup.txt
        echo '${{ secrets.GCP_SA_KEY }}' >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "# GCP_PUBSUB_KEY:" >> secrets-backup.txt
        echo '${{ secrets.GCP_PUBSUB_KEY }}' >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "================================================" >> secrets-backup.txt
        echo "INSTRUCTIONS FOR NEW REPOSITORY" >> secrets-backup.txt
        echo "================================================" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        echo "1. Go to new repo: Settings ‚Üí Secrets and variables ‚Üí Actions" >> secrets-backup.txt
        echo "2. Click 'New repository secret' for each:" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        echo "   - GCP_PROJECT_ID" >> secrets-backup.txt
        echo "   - GCP_SA_KEY (paste entire JSON)" >> secrets-backup.txt
        echo "   - GCP_PUBSUB_KEY (paste entire JSON)" >> secrets-backup.txt
        echo "   - SUPABASE_URL" >> secrets-backup.txt
        echo "   - SUPABASE_SECRET_KEY" >> secrets-backup.txt
        echo "   - SUPABASE_PUBLISHABLE_KEY" >> secrets-backup.txt
        echo "   - OPENAI_API_KEY" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        echo "3. Test deployment in new repo" >> secrets-backup.txt
        echo "4. DELETE THIS FILE after migration!" >> secrets-backup.txt
        echo "" >> secrets-backup.txt
        
        echo "‚úÖ Secrets backup created"

    - name: Upload secrets as artifact
      uses: actions/upload-artifact@v3
      with:
        name: github-secrets-backup
        path: secrets-backup.txt
        retention-days: 1  # Auto-delete after 1 day
    
    - name: Instructions
      run: |
        echo "================================================"
        echo "‚úÖ SECRETS EXPORTED SUCCESSFULLY"
        echo "================================================"
        echo ""
        echo "üì• Download the artifact:"
        echo "   1. Go to this workflow run"
        echo "   2. Scroll to bottom ‚Üí 'Artifacts' section"
        echo "   3. Download 'github-secrets-backup'"
        echo ""
        echo "‚ö†Ô∏è  SECURITY REMINDERS:"
        echo "   - This file contains ALL your secrets"
        echo "   - Keep it secure and delete after migration"
        echo "   - Artifact auto-deletes in 1 day"
        echo "   - DELETE this workflow file after use!"
        echo ""
        echo "================================================"

